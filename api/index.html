<!DOCTYPE html><html lang="en"><head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>eleventy-load</title> <meta name="description" content="Post-process files in your Eleventy project"> <style>@charset "UTF-8";html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/9e9fd431.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/624f2008.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/b8672392.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/9914692c.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0370-03FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/5913e4f3.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/2407e03f.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:400;src:url(/assets/0e55b805.woff2) format("woff2"),url(/assets/fe3eea98.woff) format("woff");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/9e9fd431.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/624f2008.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/b8672392.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+1F00-1FFF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/9914692c.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0370-03FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/5913e4f3.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/2407e03f.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-display:swap;font-weight:700;src:url(/assets/0e55b805.woff2) format("woff2"),url(/assets/d30ab3c1.woff) format("woff");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}code{background-color:#eaeaea;border-radius:.25rem;font-family:Monaco,Consolas,"Lucida Console",monospace;padding:0 .25rem .125rem}pre{position:relative}.code{background-color:#011627;border-radius:0;color:#d6deeb;display:block;margin-left:-5.5555555556%;margin-right:-5.5555555556%;overflow-x:auto;padding:1rem 5.5555555556%}@media (min-width:30rem){.code{border-radius:.5rem;margin-left:-1rem;margin-right:-1rem;padding:1rem}}.code[data-file]{padding:2rem 5.5555555556% 1rem}@media (min-width:30rem){.code[data-file]{padding:2rem 1rem 1rem}}.code[data-file]::before{background-color:#162939;border-radius:0;content:attr(data-file);font-size:80%;left:-5.5555555556%;padding:.125rem 1rem;position:absolute;right:-5.5555555556%;text-align:center;top:0}@media (min-width:30rem){.code[data-file]::before{border-radius:.5rem .5rem 0 0;left:-1rem;right:-1rem}}.code__keyword{color:#c792ea}.code__built_in{color:#addb67}.code__regexp{color:#5ca7e4}.code__string{color:#ecc48d}.code__function{color:#82aaff}.code__params{color:#7fdbca}.code__attr{color:#7fdbca}:root{font-family:Inter,system-ui,-apple-system,sans-serif;height:100%;line-height:1.5;overflow-x:hidden}:target{scroll-margin-top:1rem}body{display:flex;flex-direction:column;height:100%;overflow-x:hidden}main{flex-grow:1}h1,h2{position:relative}*,::after,::before{box-sizing:border-box}.header{margin-left:auto;margin-right:auto;max-width:60rem;width:90%;border-bottom:1px solid #eaeaea;display:flex;flex-wrap:wrap;justify-content:space-between;padding:2rem 0 1rem}.header__name{font-weight:700;margin-bottom:1rem;margin-right:2rem;text-decoration:none}.header__links{display:flex;flex-wrap:wrap}.header__link{margin-bottom:1rem;text-decoration:none}.header__link:not(:last-child){margin-right:calc(1rem + 1vw)}.content{margin-left:auto;margin-right:auto;max-width:60rem;width:90%;margin-bottom:3rem;margin-top:3rem}.content h1{margin-bottom:3rem}.content>:not(:first-child){margin-top:1rem}.content>h2:not(:first-child),.content>pre:not(:first-child){margin-bottom:2rem;margin-top:2rem}a{color:inherit}a>.icon{opacity:.5}ul{padding-left:1.5rem}ul ul{padding-left:2rem}ul ul li{margin-top:.25rem}ul li:not(:first-child){margin-top:.25rem}.icon{height:1.2em;margin-top:.15em;width:1.2em}.anchor{opacity:.1;text-decoration:none}.anchor::after{content:"";height:100%;left:0;position:absolute;top:0;width:100%}</style>
 <link rel="stylesheet" href="/assets/842b4a72.css" media="print" onload="this.media='all'"> </head> <body> <header class="header"> <a class="header__name" href="/">eleventy-load</a> <nav class="header__links"> <a class="header__link" href="/usage/">Usage</a> <a class="header__link" href="/loaders/">Loaders</a> <a class="header__link" href="/examples/">Examples</a> <a class="header__link" href="/api/">API</a> <a class="header__link" href="https://github.com/gregives/eleventy-load"><img class="icon" width="18" height="18" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktZ2l0aHViIiB2aWV3Qm94PSIwIDAgMTYgMTYiPgogIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgZD0iTTggMEMzLjU4IDAgMCAzLjU4IDAgOGMwIDMuNTQgMi4yOSA2LjUzIDUuNDcgNy41OS40LjA3LjU1LS4xNy41NS0uMzggMC0uMTktLjAxLS44Mi0uMDEtMS40OS0yLjAxLjM3LTIuNTMtLjQ5LTIuNjktLjk0LS4wOS0uMjMtLjQ4LS45NC0uODItMS4xMy0uMjgtLjE1LS42OC0uNTItLjAxLS41My42My0uMDEgMS4wOC41OCAxLjIzLjgyLjcyIDEuMjEgMS44Ny44NyAyLjMzLjY2LjA3LS41Mi4yOC0uODcuNTEtMS4wNy0xLjc4LS4yLTMuNjQtLjg5LTMuNjQtMy45NSAwLS44Ny4zMS0xLjU5LjgyLTIuMTUtLjA4LS4yLS4zNi0xLjAyLjA4LTIuMTIgMCAwIC42Ny0uMjEgMi4yLjgyLjY0LS4xOCAxLjMyLS4yNyAyLS4yNy42OCAwIDEuMzYuMDkgMiAuMjcgMS41My0xLjA0IDIuMi0uODIgMi4yLS44Mi40NCAxLjEuMTYgMS45Mi4wOCAyLjEyLjUxLjU2LjgyIDEuMjcuODIgMi4xNSAwIDMuMDctMS44NyAzLjc1LTMuNjUgMy45NS4yOS4yNS41NC43My41NCAxLjQ4IDAgMS4wNy0uMDEgMS45My0uMDEgMi4yIDAgLjIxLjE1LjQ2LjU1LjM4QTguMDEyIDguMDEyIDAgMCAwIDE2IDhjMC00LjQyLTMuNTgtOC04LTh6Ii8+Cjwvc3ZnPg==" alt="GitHub"></a> </nav> </header> <main class="content"> <h1>Writing a loader</h1> <p>An eleventy-load loader is <strong>just a JavaScript function</strong>, nothing complicated! The function is passed two arguments: the <code>content</code> of the file being loaded and the user-provided <code>options</code> for the loader.</p> <ul> <li><a href="#An-example-loader">An example loader</a></li> <li><a href="#Loader-interface">Loader interface</a> <ul> <li><a href="#this.addDependency">this.addDependency</a></li> <li><a href="#this.config">this.config</a></li> <li><a href="#this.emitFile">this.emitFile</a></li> <li><a href="#this.resource">this.resource</a></li> <li><a href="#this.resourcePath">this.resourcePath</a></li> <li><a href="#this.resourceQuery">this.resourceQuery</a></li> </ul> </li> <li><a href="#Raw-loaders">Raw loaders</a></li> </ul> <h2 id="An-example-loader">An example loader<a class="anchor" href="#An-example-loader">&nbsp;#</a></h2> <p>Letâ€™s write a loader to convert a text file to uppercase, <em>but only</em> if the user passes <code>uppercase: true</code> as an option. Of course, this loader could be applied to any file, it just uppercases the content.</p> <pre><code data-file=".eleventy.js" class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">eleventyConfig</span>) </span>{
    eleventyConfig.addPlugin(<span class="code__built_in">require</span>(<span class="code__string">"eleventy-load"</span>), {
        <span class="code__attr">rules</span>: [
            {
                <span class="code__attr">test</span>: <span class="code__regexp">/\.txt$/</span>,
                loaders: [
                    {
                        <span class="code__attr">loader</span>: <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
                            <span class="code__keyword">if</span> (options.uppercase) {
                                <span class="code__keyword">return</span> content.toUpperCase();
                            } <span class="code__keyword">else</span> {
                                <span class="code__keyword">return</span> content;
                            }
                        },
                        <span class="code__attr">options</span>: {
                            <span class="code__attr">uppercase</span>: <span class="code__literal">true</span>
                        }
                    }
                ]
            }
        ]
    });
};
</code></pre> <p>Instead of writing the loader in your Eleventy configuration file, you might want to move it into a module which exports the loader function.</p> <pre><code data-file="uppercase.js" class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__keyword">if</span> (options.uppercase) {
        <span class="code__keyword">return</span> content.toUpperCase();
    } <span class="code__keyword">else</span> {
        <span class="code__keyword">return</span> content;
    }
};
</code></pre> <pre><code data-file=".eleventy.js" class="code code--js"><span class="code__keyword">const</span> uppercaseLoader = <span class="code__built_in">require</span>(<span class="code__string">"./uppercase"</span>);

<span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">eleventyConfig</span>) </span>{
    eleventyConfig.addPlugin(<span class="code__built_in">require</span>(<span class="code__string">"eleventy-load"</span>), {
        <span class="code__attr">rules</span>: [
            {
                <span class="code__attr">test</span>: <span class="code__regexp">/\.txt$/</span>,
                loaders: [
                    {
                        <span class="code__attr">loader</span>: uppercaseLoader,
                        <span class="code__attr">options</span>: {
                            <span class="code__attr">uppercase</span>: <span class="code__literal">true</span>
                        }
                    }
                ]
            }
        ]
    });
};
</code></pre> <h2 id="Loader-interface">Loader interface<a class="anchor" href="#Loader-interface">&nbsp;#</a></h2> <p>As well as the function parameters <code>content</code> and <code>options</code>, loaders also have access to the loader context. The context of a function can be accessed using the <code>this</code> keyword.</p> <ul> <li><a href="#this.addDependency">this.addDependency</a></li> <li><a href="#this.config">this.config</a></li> <li><a href="#this.emitFile">this.emitFile</a></li> <li><a href="#this.resource">this.resource</a></li> <li><a href="#this.resourcePath">this.resourcePath</a></li> <li><a href="#this.resourceQuery">this.resourceQuery</a></li> </ul> <h3 id="this.addDependency">this.addDependency<a class="anchor" href="#this.addDependency">&nbsp;#</a></h3> <p>Add a dependency to be processed by eleventy-load. The dependency must be relative to the Eleventy projectâ€™s input directory. You should always <code>await</code> adding a dependency, as the loaders processing the dependency might be asynchronous.</p> <pre><code class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__keyword">async</span> <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__keyword">const</span> license = <span class="code__keyword">await</span> <span class="code__built_in">this</span>.addDependency(<span class="code__string">"LICENSE"</span>);
    <span class="code__keyword">return</span> license + content;
};
</code></pre> <h3 id="this.config">this.config<a class="anchor" href="#this.config">&nbsp;#</a></h3> <p>A copy of Eleventyâ€™s <code>_config</code> object available inside Eleventy transforms. Although this isnâ€™t documented and <strong>may change without notice</strong>, it contains useful information such as the projectâ€™s directories. See a <a href="/api/config/">complete example of the Eleventy config</a>.</p> <pre><code class="code code--json">{
    <span class="code__attr">"dir"</span>: {
        <span class="code__attr">"input"</span>: <span class="code__string">"src"</span>,
        <span class="code__attr">"includes"</span>: <span class="code__string">"_includes"</span>,
        <span class="code__attr">"data"</span>: <span class="code__string">"_data"</span>,
        <span class="code__attr">"output"</span>: <span class="code__string">"dist"</span>
    }
}
</code></pre> <h3 id="this.emitFile">this.emitFile<a class="anchor" href="#this.emitFile">&nbsp;#</a></h3> <p>Save content to a file in the projectâ€™s output directory. The function takes three parameters:</p> <ol> <li>The content to save, either a <code>String</code> or <code>Buffer</code>.</li> <li>The filepath in which to save the content, relative to the projectâ€™s output directory.</li> <li>A flag which dictates whether the file should be saved. Defaults to <code>true</code>, pass <code>false</code> to dry run.</li> </ol> <pre><code class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__keyword">async</span> <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__keyword">return</span> <span class="code__built_in">this</span>.emitFile(content, <span class="code__string">"assets/[name].[hash:12].css"</span>, <span class="code__literal">false</span>);
};
</code></pre> <p>The filepath can contain substitutions, useful for creating hashed files.</p> <ul> <li><code>[hash]</code> or <code>[hash:N]</code> will be replaced with a hash of the content. Specify <code>N</code> to change the length of the hash, which defaults to 8 characters.</li> <li><code>[name]</code> will be replaced with the original filename.</li> <li><code>[ext]</code> will be replaced with the original fileâ€™s extension.</li> </ul> <h3 id="this.resource">this.resource<a class="anchor" href="#this.resource">&nbsp;#</a></h3> <p>The current resource being processed, relative to the projectâ€™s input directory. Use <code>this.resourcePath</code> and <code>this.resourceQuery</code> to access the path and the query respectively.</p> <pre><code class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__built_in">console</span>.log(<span class="code__built_in">this</span>.resource); <span class="code__comment">// assets/cat.jpeg?width=1920&amp;height=1080&amp;format=webp</span>
    ...
};
</code></pre> <h3 id="this.resourcePath">this.resourcePath<a class="anchor" href="#this.resourcePath">&nbsp;#</a></h3> <p>The path of the current resource being processed, relative to the projectâ€™s input directory. Hereâ€™s an example which gets the last-modified time of the current resource.</p> <pre><code class="code code--js"><span class="code__keyword">const</span> fs = <span class="code__built_in">require</span>(<span class="code__string">"fs"</span>);
<span class="code__keyword">const</span> path = <span class="code__built_in">require</span>(<span class="code__string">"path"</span>);

<span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__built_in">console</span>.log(<span class="code__built_in">this</span>.resourcePath); <span class="code__comment">// assets/cat.jpeg</span>
    <span class="code__keyword">const</span> resource = path.resolve(<span class="code__built_in">this</span>.config.dir.input, <span class="code__built_in">this</span>.resourcePath);
    <span class="code__keyword">const</span> lastModifiedTime = fs.statSync(resource).mtime;
    ...
};
</code></pre> <h3 id="this.resourceQuery">this.resourceQuery<a class="anchor" href="#this.resourceQuery">&nbsp;#</a></h3> <p>The query of the current resource being processed. You can use <a href="https://nodejs.org/api/url.html#url_class_urlsearchparams">URLSearchParams</a> to easily parse the query.</p> <pre><code class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__built_in">console</span>.log(<span class="code__built_in">this</span>.resourceQuery); <span class="code__comment">// ?width=1920&amp;height=1080&amp;format=webp</span>
    <span class="code__keyword">const</span> params = <span class="code__keyword">new</span> URLSearchParams(<span class="code__built_in">this</span>.resourceQuery);
    <span class="code__built_in">console</span>.log(params.get(<span class="code__string">"format"</span>)); <span class="code__comment">// webp</span>
    ...
};
</code></pre> <h2 id="Raw-loaders">Raw loaders<a class="anchor" href="#Raw-loaders">&nbsp;#</a></h2> <p>By default, the content of a resource is loaded as a UTF-8 string and passed to the first loader. By setting the <code>raw</code> flag to <code>true</code>, the loader will receive a raw <code>Buffer</code> instead of a <code>String</code>. This is useful for loaders which deal with binary filetypes, such as images.</p> <pre><code class="code code--js"><span class="code__built_in">module</span>.exports = <span class="code__function"><span class="code__keyword">function</span>(<span class="code__params">content, options</span>) </span>{
    <span class="code__built_in">console</span>.log(content <span class="code__keyword">instanceof</span> Buffer); <span class="code__comment">// true</span>
    ...
};

<span class="code__built_in">module</span>.exports.raw = <span class="code__literal">true</span>;
</code></pre> </main> <footer class="footer"> <nav class="footer__links"> <a href="/usage/">Usage</a> <a href="/loaders/">Loaders</a> <a href="/examples/">Examples</a> <a href="/api/">API</a> </nav> <a class="footer__edit" href="https://github.com/gregives/eleventy-load-website/blob/master/./src/api/index.md"> Edit this page on GitHub </a> <p class="footer__information"> Made by <a class="footer__author" href="https://gregives.co.uk/">Greg Ives</a> Â© <span class="footer__year">2020</span> </p> </footer> <script src="/assets/ba453002.js" defer=""></script> </body></html>